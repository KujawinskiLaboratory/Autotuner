# R for travis: see documentation at https://docs.travis-ci.com/user/languages/r

language: R
cache: packages
r: bioc-devel 
latex: false

apt_packages:
  - libnetcdf-dev
  - netcdf-bin 
  - libgit2-dev # git2r
  - texlive-latex-recommended
  - texlive-fonts-extra

r_github_packages: crmclean/mmetspData

## adding this - because there were issues installing mzR
before_install:
  - if [[ "$TRAVIS_R_VERSION_STRING" = 'bioc-devel' ]]; then mkdir ~/.R && echo 'CXX1X=g++ -std=c++0x -g -O2 -fPIC' > ~/.R/Makevars; fi

jobs:
  include:
    - stage: "Build"
      r_packages:
        - covr
        - testthat
        - knitr
        - roxygen2
      before_install:
        - mkdir -p ~/.R
        - echo -e 'MAKEFLAGS = -j2' > ~/.R/Makevars
        - echo 'options(Ncpus = 2)' > ~/.Rprofile
        - echo 'options(repos = c(CRAN = "https://cran.rstudio.com"))' > ~/.Rprofile
        - echo 'utils::chooseCRANmirror(ind = 1)' > ~/.Rprofile
      script: true
      name: "Build dependencies and cache"
    - stage: "Check"
      r_build_args: --no-build-vignettes --no-manual
      r_check_args: --as-cran --no-build-vignettes --no-vignettes --no-manual --no-tests
      before_script: rm -rf vignettes
      install: skip
      name: "examples"
    - r_build_args: --no-build-vignettes --no-manual
      r_check_args: --as-cran --no-build-vignettes --no-vignettes --no-manual --no-codoc --no-examples
      install: skip
      before_script: rm -rf vignettes
      name: "tests"
    - r_build_args:
      r_check_args: --as-cran --no-build-vignettes --no-codoc --no-examples --no-tests
      install: skip
      name: "vignettes"
